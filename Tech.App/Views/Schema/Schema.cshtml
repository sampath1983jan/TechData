
@{
    ViewBag.Title = "Schema";
}
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<h2>Schema</h2>
<style>
   
</style>
<div class="padd5l">
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-9">
            <div id="navBtnList"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <div id="lftSchema"></div>
        </div>

        <div class="col-md-9">
            <div class="row" id="rghtbinfo">
                @*<div class="col-md-9">
                    <div id="rghTable"></div>
                </div>
                <div class="col-md-3">
                    <div id="rgfieldinfo"></div>
                </div>*@
            </div>
            
            </div>

        </div>
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-9">
            <div id="saveaction">
               
            </div>
        </div>
        <div id="mkd"></div>
    </div>

    </div>
    <script type="text/javascript">
        $(document).ready(function () {                   
            (function ($schema) {
                $schema.Schema = function (options) {
                    var defaults = {
                        ClientID: "",
                        View: "",
                        plc: "",
                    }
                    var _opt = $.extend({}, defaults, options);
                    var tbl = {};
                    var tbID = "";
                    var renderTableList = function ($plc, data) {
                        $plc.html("");
                        //list-group
                        var sq = "<ul class='selectable'>"
                        $.each(data, function (id, d) {
                            sq = sq + "<li class=''><a href='#' name='" + d.TableID + "'>" + d.TableName + "</a></li>";
                        }); 
                        sq=sq+"</ul>"
                        $plc.append(sq);
                        $plc.find("a").click(function () {
                            tbID = $(this).attr("name");
                            renderViewTable();
                        })
                    }
                    var getTableList = function (onComplete) {                        
                        $.ajax('/Schema/GetTables',
                            {
                                type: "GET",
                                dataType: 'jsonp', // type of response data
                                data: ({ clientid: _opt.ClientID }),
                                // timeout milliseconds
                                success: function (data, status, xhr) {   // success callback function                                   
                                    onComplete(data);
                                },
                                error: function (jqXhr, textStatus, errorMessage) { // error callback
                                    alert(errorMessage);
                                    //$('p').append('Error: ' + errorMessage);
                                }
                            });
                    }
                    var renderViewTable = function () {
                        renderView();
                        tbl = new $schema.Table({
                            ClientID: _opt.ClientID,
                            TableID: tbID,
                            plc: "rghTable",
                            onAdd: function (tbid) {
                                tbID = tbid;
                                render();
                            }
                        });
                    }
                    var renderNew = function () {
                        renderView();
                        tbl = new $schema.Table({
                            ClientID: _opt.ClientID,
                            TableID: "",
                            plc: "rghTable",
                            onAdd: function (tbid) {
                                render();
                            }
                        });
                    }
                    var RenderGrid =function(cpage) {
                        $.ajax({
                            type: "POST",
                            url: "/schema/GetData",
                            data: JSON.stringify({
                                currentPage: cpage, pageSize: 10, clientid: _opt.ClientID, tbid: tbID
                            }),
                            dataType: "jsonp",
                            contentType: 'application/json; charset=utf-8',
                            success: function (data) {
                              //  $("#txtPageNo").val(currentPage);
                                data = JSON.parse(data);
                                Page = data.Page;
                                data = data.Data;
                                var keys = [];
                                if (data.length > 0) {
                                    for (var key in data[0]) {
                                        keys.push(key);
                                    }
                                }
                                $("#datalist").html("");
                                //datalist
                                str = "<table style='width:100%'>"
                                str = str + "<tr>";
                                $.each(keys, function (ir, r) {

                                    str = str + "<td>" + r + "</td>";

                                });
                                str = str + "</tr>";
                                $.each(data, function (ir, r) {
                                    str = str + "<tr>";
                                    $.each(keys, function (ic, c) {
                                        str = str + "<td>" + r[c] + "</td>";
                                    })
                                    str = str + "</tr>";
                                });
                                str = str + "</table>";
                                $("#datalist").append(str);
                             //   $("#ttrc").html("<h3> Total Record in this table:" + Page.TotalRecord + "</h3>");
                                //data = data.Columns;
                                //$.each(data, function (i, d) {
                                //    $("#fields").append("<div class='row mar'><div class='col-md-6'>" + d.Name + "</div><div class='col-md-2'>" + d.NativeType + "</div><div class='col-md-2'>" + d.Size + "</div><div class='col-md-2'>" + d.PrimaryKey + "</div></div>");
                                //})
                            },
                            error: function () {
                                alert("Error occured!!")
                            }
                        });
                    }
                    var renderToolbar = function () {
                        $("#navBtnList").toolbar({
                            name: "", linkbuttons: ['<a class="nav-link " href="#" name="veSchema">View Schema <span class="sr-only">(current)</span></a>',
                                '<a class="nav-link active" href="#" name="addtb">Add Table <span class="sr-only">(current)</span></a>',
                                '<a class="nav-link" name="rmtb" href="#">Remove</a>',
                                '<a class="nav-link" name="vbTb" href="#">View Data</a>',
                                '<a class="nav-link" name="csync" href="#">Sync</a>']
                        })
                        $("#navBtnList").find("a[name=veSchema]").click(function () {
                            if (_opt.ClientID != "") {
                                renderView();
                                renderViewTable();
                            } else {
                                alert("Choose Client");
                            }
                        })
                        $("#navBtnList").find("a[name=addtb]").click(function () {
                            if (_opt.ClientID != "") {
                                renderView();
                                renderNew();
                            } else {
                                alert("Choose Client");
                            }                                        
                        })
                        $("#navBtnList").find("a[name=csync]").click(function () {
                            $.ajax('/Schema/syncSchema',
                                {
                                    dataType: 'jsonp', // type of response data
                                    data: (({ clientid: _opt.ClientID})),
                                    // timeout milliseconds
                                    success: function (data, status, xhr) {   // success callback function
                                        // alert(data);
                                      //  onComplete();
                                    },
                                    error: function (jqXhr, textStatus, errorMessage) { // error callback
                                        alert(errorMessage);
                                    }
                                });
                        })
                        $("#navBtnList").find("a[name=rmtb]").click(function () {

                            $("#mkd").dialogBox({
                                id: 'wd',
                                title: "",
                                message: "Are you Sure,Do you want remove this table?",
                                onAction: function () {
                                    $("#mkd").dialogBox('hide');
                                    if (_opt.ClientID != "") {
                                        removeTable(function () {
                                            render();
                                            renderNew();
                                        })
                                    } else {
                                        alert("Choose Client");
                                    }
                                },
                                onCancel: function () {                                    

                                },
                                type:2,
                                alertType: 3,
                            })
                            $("#mkd").dialogBox('show');                            
                        })
                        $("#navBtnList").find("a[name=vbTb]").click(function () {
                            $("#rghtbinfo").html("");
                            $("#rghtbinfo").append("<div col-md-12><div id='datalist'></div> </div>");
                            RenderGrid(0);
                        })
                    }
                  
                    var removeTable = function ( onComplete) {
                        $.ajax('/Schema/RemoveTable',
                            {
                                dataType: 'jsonp', // type of response data
                                data: (({ clientid: _opt.ClientID, tbID: tbID })),
                                // timeout milliseconds
                                success: function (data, status, xhr) {   // success callback function
                                    // alert(data);
                                    onComplete();
                                },
                                error: function (jqXhr, textStatus, errorMessage) { // error callback
                                    alert(errorMessage);
                                }
                            });
                    }
                    var renderClients = function (data) {
                        //var dv = "<div class='row'>"
                        var aindex = 0;
                        $("#lftSchemacnt").html("");
                        var dv = "";
                        $.each(data, function (i, d) {
                            dv = dv + "<h3><a href='#' name='" + d.ClientID + "'>" + d.OrganizationName + "-" + d.ClientName + "</a></h3>";
                            dv = dv + "<div plc='cont'   class='padd5 plns' name='" + d.ClientID + "'></div>"
                            if (_opt.ClientID == "") {
                                if (i == 0) {
                                    _opt.ClientID = d.ClientID;
                                }                                
                            }
                            if (d.ClientID == _opt.ClientID) {
                                aindex = i;
                            }                            
                        })
                        //dv = dv + "</div>"
                        $("#lftSchemacnt").append(dv);
                        $("#lftSchemacnt").find("a").click(function () {

                            _opt.ClientID = $(this).attr("name");
                            //renderTables();
                        });
                        var already_loaded = new Object();
                        $("#lftSchemacnt").accordion({
                            collapsible: true,
                            heightStyle: "fill",
                            //active: false,
                            active: aindex,
                            //heightStyle: 'fill', // http://jqueryui.com/accordion/#fillspace  -- Just sets the height of the accordion to the height of it's parent container.  We need a way to change the height of the parent to that of the newly added content.
                            activate: function (e, ui) {
                                // only fire when the accordion is opening..
                                if (ui.newHeader.length > 0) {
                                    // only retrieve the remote content once..
                                    if (!already_loaded[ui.newHeader[0].id] == 1) {
                                        var srcObj = $(ui.newHeader[0]).children('a');
                                       // var url = srcObj.attr('name');
                                        _opt.ClientID = srcObj.attr("name");
                                        getTableList(function (data) {
                                            renderTableList($(ui.newHeader[0]).next(), data);
                                            var contentDiv = $(ui.newHeader[0]).next()[0];
                                            $("#lftSchemacnt").accordion("refresh");
                                            already_loaded[ui.newHeader[0].id] = 1;
                                        });
                                    }
                                }
                            }
                        });
                        $("#lftSchemacnt").find("div[plc=cont]").css("overflow-x", "hidden !important");
                        getTableList(function (data) {
                            var itm = $("#lftSchemacnt").find("div[plc=cont]")[aindex];
                            renderTableList($(itm), data);
                            //var contentDiv = itm[0];
                            $("#lftSchemacnt").accordion("refresh");
                           // already_loaded[ui.newHeader[0].id] = 1;
                        });

                    }
                    var getClientlist = function (onComplete) {
                        $.ajax('/Client/Gets',
                            {
                                type: "GET",
                                dataType: 'jsonp', // type of response data
                                data: "",
                                // timeout milliseconds
                                success: function (data, status, xhr) {   // success callback function
                                    $("#lftSchemacnt").html("");
                                    onComplete(data);
                                },
                                error: function (jqXhr, textStatus, errorMessage) { // error callback
                                    alert(errorMessage);
                                    //$('p').append('Error: ' + errorMessage);
                                }
                            });
                    }
                    var renderView = function () {
                        $("#rghtbinfo").html("");
                        $("#rghtbinfo").append('<div class="col-md-8"><div id = "rghTable" ></div ></div ><div class="col-md-4"><div id="rgfieldinfo"></div></div>');
                    }
                    var render = function () {
                        $("#lftSchema").html("");
                        renderView();
                        $("#lftSchema").append("<div id='lftSchemacnt' style='height:550px;'></div>")
                        renderToolbar();
                        getClientlist(function (data) {
                            renderClients(data);
                        });
                    }
                    render();
                }
                $schema.Table = function (options) {
                    var defaults = {
                        ClientID: "",
                        TableID: "",
                        Fields: [],
                        plc: "",
                        View: "",
                        onAdd: function (tbid) {

                        },
                    }
                    var tbName = "";
                    var category = "";
                    var defaultsfield = {
                        FieldID: "",
                        FieldName: "",
                        FieldType: 0,
                        Length: 0,
                        IsNull: true,
                        IsPrimary: false,
                        TableID:"",
                    }
                    var cthis = this;
                    var Save = function () {
                        var tb = $("#fldTabName").Input("text");
                        var cat = $("#fldTabCatg").Input("text");
                        var fs = [];
                        var tbl = {};
                        tbl.TableName = tb;
                        tbl.Category = cat;
                        tbl.TableID = _opt.TableID;
                        $.each(_opt.Fields, function (ifd, fd) {
                            var f = {};
                            f.TableID = _opt.TableID;
                            f.FieldName = fd.FieldName;
                            f.FieldType = fd.FieldType;
                            f.Length = fd.Length;
                            f.IsNullable = fd.IsNull;
                            f.IsPrimaryKey = fd.IsPrimary;
                            f.FieldID = fd.FieldID;
                            //f.TableID = "";
                            fs.push(f);
                        })
                        $.ajax('/Schema/SaveTableField',
                            {
                                dataType: 'jsonp', // type of response data
                                data: (({ clientid: _opt.ClientID, tb: JSON.stringify(tbl), fields: JSON.stringify(fs) })),
                                // timeout milliseconds
                                success: function (data, status, xhr) {   // success callback function
                                    // alert(data);
                                    //renderFields();
                                    if (_opt.TableID == "") {
                                        _opt.TableID = data;
                                        _opt.onAdd(data);
                                        render();
                                    }                                    
                                },
                                error: function (jqXhr, textStatus, errorMessage) { // error callback
                                    alert(errorMessage);
                                    //$('p').append('Error: ' + errorMessage);
                                }
                            });
                    }
                    var _opt = $.extend({}, defaults, options);
                    var renderTable = function () {
                        $("#tbplc").html("");
                        $("#tbplc").append("<div class='row'><div class='col-md-6' id='fldTabName'></div><div class='col-md-6' id='fldTabCatg'></div></div>");
                        $("#tbplc").labelfields({
                            items: [{
                                label: "Table Name",
                                field: {
                                    id: "fdtbName", 'note': "Enter Table Name",
                                    limit: true, maxlength: 50, inputType: 1, textType: 1, timeformat: 0, 'regexp': "", "text": tbName,
                                    format: "hex", range: false, isRequired: true,
                                },
                                id: 'fldTabName'
                            }, {
                                label: "Category",
                                field: {
                                    id: "fdcatgory", 'note': "",
                                    limit: true, maxlength: 50, inputType: 1, textType: 1, timeformat: 0, 'regexp': "", "text": category,
                                    format: "hex", range: false, isRequired: true,
                                },
                                id: 'fldTabCatg'
                            }]
                        });
                        
                        renderFields();
                    }
                    var getTable = function (onComplete) {
                        $.ajax('/Schema/GetTable',
                            {
                                type: "GET",
                                dataType: 'jsonp', // type of response data
                                data: ({ clientid: _opt.ClientID,tableid:_opt.TableID }),
                                // timeout milliseconds
                                success: function (data, status, xhr) {   // success callback function                                   
                                    tbName = data.TableName;
                                    category = data.Category;
                                    _opt.Fields = [];
                                    $.each(data.Fields, function (id,d) {
                                        var f = {};
                                        f.FieldID = d.FieldID;
                                        f.FieldName = d.FieldName;
                                        f.FieldType = d.FieldType;
                                        f.Length = d.Length;
                                        f.IsNull = d.IsNullable;
                                        f.TableID = d.TableID;
                                        f.IsPrimary = d.IsPrimaryKey;
                                        _opt.Fields.push(f);
                                    })
                                    onComplete(data);
                                },
                                error: function (jqXhr, textStatus, errorMessage) { // error callback
                                    alert(errorMessage);
                                    //$('p').append('Error: ' + errorMessage);
                                }
                            });
                    }
                    var getFieldType = function (id) {
                        //  var ft = $$.Utility.filter({ key: id });
                        var sl = [];
                        $.each(fieldtype, function (ift, ft) {
                            if (ft.key == id) {
                                sl = ft;
                            }
                        });
                        if (sl.value != undefined) {
                            return sl.value;
                        }
                        else {
                            return "";
                        }


                    }
                    var renderFields = function () {
                        $("#fldinfo").html("");
                        $("#fldinfo").append("<div class='row'><div class='col-md-8'>Field List</div><div class='col-md-4'><input type='button' id='btnAddField' value='Add Field'/></div></div><div class='row'><div  class='col-md-12'><div id='fldlist' class=''></div></div></div>");
                        $.each(_opt.Fields, function (ifd, fd) {
                            
                            var finf = "<div class='row' name='"+ fd.FieldID +"'><div class='col-md-5'>" + fd.FieldName + "</div>";
                            finf = finf + "<div class='col-md-3'>" + getFieldType(fd.FieldType) + "</div>";
                            finf = finf + "<div class='col-md-1'>" + fd.Length + "</div>";
                            finf = finf + "<div class='col-md-1'>" + fd.IsNull + "</div>";
                            finf = finf + "<div class='col-md-1'>" + fd.IsPrimary + "</div>";                            
                            finf = finf + "<div class='col-md-1'><a href='#' na ='" + fd.FieldName + "' key='" + fd.FieldID + "' act='remove'>Remove</a></div>";
                            finf = finf + "</div>";
                            $("#fldlist").append(finf);
                        });
                        $("#fldlist").find("a[act=remove]").click(function () {
                            if (_opt.TableID != "") {                                
                                var fn = $(this).attr("key");
                                if (fn == "") {
                                      fn = $(this).attr("na");
                                    var fs = [];
                                    $.each(_opt.Fields, function (ifs, f) {
                                        if (f.FieldName != fn) {
                                            fs.push(f);
                                        }
                                    })
                                    _opt.Fields = fs;
                                    renderFields();
                                } else {
                                    removeField(fn, function () {
                                        render();
                                    });
                                }                                
                            } else {
                                var fn = $(this).attr("na");
                                var fs = [];
                                $.each(_opt.Fields, function (ifs,f) {
                                    if (f.FieldName != fn) {
                                        fs.push(f);
                                    }
                                })
                                _opt.Fields = fs;
                                renderFields();
                            }
                        })
                        $("#fldlist").find("div[class=row]").click(function () {
                            var fid = $(this).attr("name");
                            renderField(fid);
                        })
                        $("#btnAddField").click(function () {
                            renderField("");
                        })
                    }

                    var removeField = function (f,onComplete) {
                        $.ajax('/Schema/RemoveField',
                            {
                                dataType: 'jsonp', // type of response data
                                data: (({ clientid: _opt.ClientID, tbID: _opt.TableID, fieldID: (f) })),
                                // timeout milliseconds
                                success: function (data, status, xhr) {   // success callback function
                                    // alert(data);
                                    onComplete();
                                },
                                error: function (jqXhr, textStatus, errorMessage) { // error callback
                                    alert(errorMessage);                                    
                                }
                            });
                    }

                    var fieldtype = [
                        //{ key: 0, value: "Select" },
                        { key: 16, value: "String" },
                        { key: 10, value: "Small Number" },
                        { key: 11, value: "Number" },
                        { key: 12, value: "Double" },
                        { key: 7, value: "Decimal" },
                        { key: 6, value: "DateTime" },
                        { key: 5, value: "Date" },
                        { key: 3, value: "Boolean" },
                        { key: 4, value: "Currency" },
                        { key: 17, value: "Time" },
                    ]
                    var renderFieldInfo = function (fid) {

                        var fld = {}
                        if (fid != undefined && fid !="") {
                            $.each(_opt.Fields, function (ifd, fd) {
                                if (fd.FieldID == fid) {
                                    fld = fd;
                                }
                            });
                        } else {
                            fld = $.extend({}, defaultsfield, {});
                        }
                        
                         
                        $("#sfldinfo").labelfields({
                            
                            items: [{
                                label: "Field Name",
                                field: {
                                    id: "fdfieldname", 'note': "",
                                    limit: true, maxlength: 50, inputType: 1, textType: 1, timeformat: 0, 'regexp': "", "text": fld.FieldName,
                                    format: "hex", range: false, isRequired: true,
                                },
                                id: 'tbfldName'
                            }, {
                                label: "Field Type",
                                field: {
                                    id: "fdfldtype", 'note': "",
                                    limit: true, maxlength: 50, inputType: 19, textType: 1, timeformat: 0, 'regexp': "", "text": fld.FieldType,
                                    format: "hex", range: false, isRequired: true,
                                    selectPicker: {
                                        datasource: fieldtype,
                                        displayField: "value",
                                        valueField: "key",
                                        selection: "single"
                                    }
                                },
                                id: 'tbfldType'
                            }, {
                                label: "Length",
                                field: {
                                    id: "fldlength", 'note': "",
                                    limit: true, maxlength: 50, inputType: 2, textType: 1, timeformat: 0, 'regexp': "", "text": fld.Length,
                                    format: "hex", range: false, isRequired: true,
                                },
                                id: 'tbfldlength'
                            }, {
                                label: "Is Primarykey",
                                field: {
                                    id: "fldfieldprimary", 'note': "Is Primary key",
                                    limit: true, maxlength: 50, inputType: 10, textType: 1, timeformat: 0, 'regexp': "", "text": fld.IsPrimary,
                                    format: "hex", range: false, isRequired: true,
                                },
                                    id: 'tbfldprimary'
                            }, {
                                label: "Is Null",
                                field: {
                                    id: "fldnull", 'note': "Is Nullable",
                                    limit: true, maxlength: 50, inputType: 10, textType: 1, timeformat: 0, 'regexp': "", "text": fld.IsNull == "" ? true : fld.IsNull,
                                    format: "hex", range: false, isRequired: true,
                                },
                                    id: 'tbfldnull'
                            }]
                        });
                    }
                    var collectSaveFieldInfo = function (fid) {
                        var f = {};
                        f.FieldID = fid;
                        f.FieldName = $("#tbfldName").Input("text");
                        f.FieldType = $("#tbfldType").Input("text");
                        f.Length = $("#tbfldlength").Input("text");
                        f.IsNullable = $("#tbfldnull").Input("text");
                        f.IsPrimaryKey = $("#tbfldprimary").Input("text");
                        return f;
                    }
                    var collectFieldInfo = function (fid) {
                        var f = {};
                        if (fid == undefined) {
                            fid = "";
                        }
                        f.FieldID = fid;
                        f.FieldName = $("#tbfldName").Input("text");
                        f.FieldType = $("#tbfldType").Input("text");
                        f.Length = $("#tbfldlength").Input("text");
                        f.IsNull = $("#tbfldnull").Input("text");
                        f.IsPrimary = $("#tbfldprimary").Input("text");
                        return f;
                    }
                    var renderField = function (fid) {
                        //fieldname,fieldtype,length,isprimary,isnull,
                        $("#rgfieldinfo").html("");
                        var fld = "<div class='float-label '><div id='sfldinfo' class='row'>";
                        fld = fld + "<div id='tbfldName' class='col-md-12'></div>";
                        fld = fld + "<div id='tbfldType' class='col-md-12'></div>";
                        fld = fld + "</div>";
                        fld = fld + "<div class='row'>";
                        fld = fld + "<div id='tbfldlength' class='col-md-12'></div>";
                        fld = fld + "<div id='tbfldnull' class='col-md-12'></div>";
                        fld = fld + "<div id='tbfldprimary' class='col-md-12'></div>";
                        fld = fld + "</div>";
                        fld = fld + "<div class='row'>";
                        fld = fld + '<button type="button" class="btn btn-primary" action="save">Save</button>'
                        fld = fld + "</div>";
                        fld = fld + "</div>";
                        $("#rgfieldinfo").append("<div class='col-md-12'><div class='col-md-12'>Field Information</div>" + fld + "</div>");
                        renderFieldInfo(fid);
                        $("#rgfieldinfo").find("button[action=save]").click(function () {
                            if (_opt.TableID != "") {
                                if (fid == "") {
                                    var f = collectSaveFieldInfo(fid);
                                    saveField(f, function () {
                                        render(cthis);
                                    });
                                } else {
                                    var f = collectSaveFieldInfo(fid);
                                    UpdateField(f, function () {
                                        render(cthis);
                                    });
                                }
                            }
                             else {
                                _opt.Fields.push(collectFieldInfo(fid));
                                renderFields();
                                renderField();
                            }

                            
                        })
                        
                    }
                    var UpdateField = function (f, onComplete) {
                        $.ajax('/Schema/UpdateField',
                            {
                                dataType: 'jsonp', // type of response data
                                data: (({ clientid: _opt.ClientID, tbID: _opt.TableID, fields: JSON.stringify(f) })),
                                // timeout milliseconds
                                success: function (data, status, xhr) {   // success callback function
                                    // alert(data);
                                    onComplete();
                                },
                                error: function (jqXhr, textStatus, errorMessage) { // error callback
                                    alert(errorMessage);
                                    //$('p').append('Error: ' + errorMessage);
                                }
                            });
                    }
                    var saveField = function (f,onComplete) {
                        $.ajax('/Schema/AddField',
                            {
                                dataType: 'jsonp', // type of response data
                                data: (({ clientid: _opt.ClientID, btid: _opt.TableID, fields: JSON.stringify(f) })),
                                // timeout milliseconds
                                success: function (data, status, xhr) {   // success callback function
                                    // alert(data);
                                    onComplete();
                                },
                                error: function (jqXhr, textStatus, errorMessage) { // error callback
                                    alert(errorMessage);
                                    //$('p').append('Error: ' + errorMessage);
                                }
                            });
                    }
                    var render = function (cthis) {
                        $("#" + _opt.plc).html("");
                        $("#saveaction").html("");
                        $("#saveaction").append(' <input type="button" id="btnSaveTable" class="btn  btn-primary" value="Accept Changes" />');
                        $("#saveaction").append('<input type = "button" id = "btnReverse" value = "Retract" class= "btn  btn-default" />');
                        $("#" + _opt.plc).append("<div><div id='tbplc' class='float-label '></div><div id='fldinfo' class=''></div><div class='row' id='fddetail'></div></div>");
                        if (_opt.TableID != "") {
                            getTable(function () {
                                renderTable();
                            })
                        } else {
                            renderTable();
                        }
                        //renderTable();
                        $("#btnSaveTable").click(function () {
                            Save();
                        })
                    }
                    render(this);
                }

            })($)
            var s = new $.Schema({});
          
        });
    </script>

